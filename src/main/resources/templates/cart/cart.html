<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layout/index-layout :: setContent(~{this::content})}">
    <th:block th:fragment="content">


    <body>
        
        <div class="container" style="width:65%">
            <div class="cart"> 장바구니 </div>
            <hr>
            <!-- ------------------ -->
            <div style="text-align: right;margin-bottom: 20px;">
                <button type="button" class="btn btn-primary" id="btn-delete">삭제</button>
            </div> 
            
            <div class="border-bottom py-1 d-flex align-items-center">
                <input type="checkbox" class="custom-control-input mr-3">
                <div class="mr-3 bg-img" style="min-width: 110px; width: 110px; min-height: 110px; background-color:black;"></div>
                
                    <div style="width: 100%; height:110px;float:left;">
                    <h3>건조한 눈엔 닥터보이어 60정</h3>
                    <h>Dr.voir  30일분</h>
                    <h4>49000원</h4>
                    
                    </div>
                    
                    
                
                <!-- <table class="table " id="tbl-product">
                    <colgroup>
                        <col style="width: 70%; height: 50%;" />
                        <col style="width: 30%; height: 50%;" />
                    </colgroup>
                    <tbody>
                        <tr>
                            <th>제품명</th>
                            <td>14000원</td>   
                        </tr>
                        <tr>
                            <td>회사명</td>
                            <td>갯수표</td>   
                        </tr>
                    </tbody>
                </table> -->
            </div>
            
            <div class="border-bottom py-1 d-flex align-items-center">
                <input type="checkbox" class="custom-control-input mr-3">
                <div class="mr-3 bg-img" style="min-width: 110px; width: 110px; min-height: 110px; background-color:black;"></div>
                <table class="table " id="tbl-product">
                    <colgroup>
                        <col style="width: 70%; height: 50%;" />
                        <col style="width: 30%; height: 50%;" />
                    </colgroup>
                    <tbody>
                        <tr>
                            <th>제품명</th>
                            <td>14000원</td>   
                        </tr>
                        <tr>
                            <td>회사명</td>
                            <td>갯수표</td>   
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="border-bottom py-1 d-flex align-items-center">
                <input type="checkbox" class="custom-control-input mr-3">
                <div class="mr-3 bg-img" style="min-width: 110px; width: 110px; min-height: 110px; background-color:black;"></div>
                <table class="table " id="tbl-product">
                    <colgroup>
                        <col style="width: 70%; height: 50%;" />
                        <col style="width: 30%; height: 50%;" />
                    </colgroup>
                    <tbody>
                        <tr>
                            <th>제품명</th>
                            <td>14000원</td>   
                        </tr>
                        <tr>
                            <td>회사명</td>
                            <td>갯수표</td>   
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- -----------order------- -->
            <div style=" text-align: right;margin-bottom: 40px;">
                총금액 0000000 원
            </div> 

            <div class=" mx-n1 mx-md-n3 mt-5 justify-content-center" style="border-top: 2px solid rgb(43, 47, 58); flex: 10%;">
                <div class= "px-md-3 py-2 " style="width: 50%; float:right; margin-top: 40px;">

                    <div class="">
                        <button type="button" class="btn btn-m text-16 btn-primary" style="width: 49%; float:left;"> 선택 주문 </button>
                    </div>

                    <div class="">
                        <button type="button" class="btn btn-m text-16 btn-default" style="width: 49%; float:right;"> 전체 주문 </button>
                    </div>

                </div>

                
            
            </div>
            <div class="col-md-5 col-sm-5" style="margin-bottom: 200px;"></div> 
            

        
        <script>
            $(document).ready(function(){
            
                // check box 눌렀을 경우 정보 담아주는 변수
                var cart = {
                    buyList : [],
                    init : function() {
                        //buyList 초기화
                        this.buyList = [];
                    },
                    getBuyList : function(obj) {
                        return this.buyList;
                    },
                    getFindIndex : function(cd) {
                        //배열 중복 검색
                        var fIdx = -1;
                        this.buyList.forEach(function(item, idx, ary) {
                            if(item.code == cd) {
                                fIdx = idx;
                            }
                        });
                        return fIdx;
                    },
                    addBuyList : function(obj) {
                        var fIdx = this.getFindIndex(obj.code);
                        if(fIdx == -1) {
                            this.buyList.push(obj);
                        } else {
                            this.buyList[fIdx] = obj;
                        }
                        this.render();
                    },
                    deleteBuyList : function(cd) {
                        this.buyList.splice(this.getFindIndex(cd), 1);
                        this.render();
                    },
                    getTotalPay : function() {
                        //총 결제금액 계산
                        var totalQty = 0;
                        var totalPrice = 0;
                        
                        this.buyList.forEach(function(item, idx, ary) {
                            totalQty += Number(item.qty);
                            totalPrice += Number(item.price)*Number(item.qty);
                        });
                        return {
                            totalQty : totalQty,
                            totalPrice : totalPrice
                        };
                    },
                    render : function() {            
                        // 주문 table 그리기
                        var order = $('#tbl-order tbody');
                        if(this.buyList.length > 0) {
                            var html = [];
                            this.buyList.forEach(function(item, idx, ary) {
                                html.push([
                                    '<tr data-cd="', item.cd ,'">',                        
                                    '<td>', item.title, '</td>',
                                    '<td>', item.price, '</td>',
                                    '<td>', item.qty, '</td>',
                                    '<td>', Number(item.price)*Number(item.qty), '</td>',
                                    '</tr>'
                                ].join(''));
                            });
                            order.html(html);
            
                            // 총 결제금액&수량 table 그리기
                            var total = this.getTotalPay();
                            $('#total-qty').val(total.totalQty);
                            $('#total-amt').val(total.totalPrice);
                            $('#tbl-order').show();                
            
                        } else {
                            // 주문내역 table 숨기기
                            $('#tbl-order').hide();                
                 
                            // 주문내역 지우기
                            order.empty();
                 
                            // 총 결제정보 지우기
                            $('#total-qty').val(0);
                            $('#total-amt').val(0);
                        }            
                    }
                };
            
                // 수량 클릭 시
                $('.edt-qty').on('change', function() {
                    var tr = $(this).closest('tr');
                    var code = tr.children('td:eq(1)').text();
                    var title = tr.children('td:eq(2)').text();
                    var price = Number(tr.children('td:eq(3)').text());
                    var qty = Number(tr.children('td:eq(4)').find('input').val());
            
                    // 수량이 0 초과하는 경우 buyList에 추가 
                    // 수량이 0 이하인 경우 buyList에서 삭제
                    if(qty > 0) {
                        var obj = {
                            code : code,
                            title : title,
                            price : price,
                            qty : qty
                        }
                        cart.addBuyList(obj);
                    } else {
                        cart.deleteBuyList(code);
                    }
                    console.log(cart.getBuyList());
                });
            
                // 삭제 버튼 클릭 시
                $('#btn-delete').on('click', function() {
            
                    var chkList = $('input[name="fruit"]:checked');        
                    var cd;
            
                    // chcekd 된 product row 삭제
                    // order row 삭제
                    for(var i = chkList.length-1; i > -1; i--) {
                        cd = chkList.eq(i).closest('tr').find('td:eq(1)').text();            
                        chkList.eq(i).closest('tr').remove();
                        cart.deleteBuyList(cd);
                    }     
                });
            
            }); //end document ready
            
            $.fn.serializeObject = function() {
                "use strict";
                
                var result = {};
                var extend = function(i, element) {
                    var node = result[element.name];
            
                    if ('undefined' !== typeof node && node !== null) {
                        if ($.isArray(node)) {
                            node.push(element.value);
                        } else {
                            result[element.name] = [ node, element.value ];
                        }
                    } else {
                        result[element.name] = element.value;
                    }
                };
            
                $.each(this.serializeArray(), extend);
                return result;
            };
            </script>

    </body>
    </th:block>
</th:block>
</html>